# Migration `20200609231041-init`

This migration has been generated by Luke Hamilton at 6/9/2020, 11:10:41 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."User" (
"address" text  NOT NULL ,"auth0id" text  NOT NULL ,"avatar" text   ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"email" text  NOT NULL ,"firstName" text   ,"headline" text   ,"id" text  NOT NULL ,"identity" text   ,"lastName" text   ,"name" text   ,"name_lower" text   ,"privateKey" text  NOT NULL ,"role" "Role" NOT NULL DEFAULT E'USER',"updatedAt" timestamp(3)  NOT NULL ,"username" text   ,"username_lower" text   ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Topic" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"description" text   ,"followersCount" integer   ,"id" text  NOT NULL ,"image" text   ,"name" text  NOT NULL ,"postsCount" integer   ,"slug" text  NOT NULL ,"trending" boolean   ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Post" (
"archived" boolean  NOT NULL DEFAULT false,"author" text   ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"date" text   ,"description" text   ,"id" text  NOT NULL ,"image" text   ,"logo" text   ,"pinned" boolean  NOT NULL DEFAULT false,"publisher" text   ,"sectionId" text   ,"submitterId" text  NOT NULL ,"title" text   ,"topicId" text   ,"updatedAt" timestamp(3)  NOT NULL ,"url" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Comment" (
"authorId" text  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"parentId" text   ,"postId" text   ,"text" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."CommentVote" (
"commentId" text  NOT NULL ,"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Vote" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"postId" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Section" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"date" text  NOT NULL ,"id" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."SignedUpload" (
"createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"signedRequest" text  NOT NULL ,"updatedAt" timestamp(3)  NOT NULL ,"url" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."_follows" (
"A" text  NOT NULL ,"B" text  NOT NULL )

CREATE TABLE "public"."_TopicToUser" (
"A" text  NOT NULL ,"B" text  NOT NULL )

CREATE UNIQUE INDEX "User.username" ON "public"."User"("username")

CREATE UNIQUE INDEX "User.username_lower" ON "public"."User"("username_lower")

CREATE UNIQUE INDEX "User.auth0id" ON "public"."User"("auth0id")

CREATE UNIQUE INDEX "Topic.slug" ON "public"."Topic"("slug")

CREATE UNIQUE INDEX "Section.date" ON "public"."Section"("date")

CREATE UNIQUE INDEX "_follows_AB_unique" ON "public"."_follows"("A","B")

CREATE  INDEX "_follows_B_index" ON "public"."_follows"("B")

CREATE UNIQUE INDEX "_TopicToUser_AB_unique" ON "public"."_TopicToUser"("A","B")

CREATE  INDEX "_TopicToUser_B_index" ON "public"."_TopicToUser"("B")

ALTER TABLE "public"."Post" ADD FOREIGN KEY ("submitterId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Post" ADD FOREIGN KEY ("topicId")REFERENCES "public"."Topic"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Post" ADD FOREIGN KEY ("sectionId")REFERENCES "public"."Section"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("postId")REFERENCES "public"."Post"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("authorId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("parentId")REFERENCES "public"."Comment"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."CommentVote" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."CommentVote" ADD FOREIGN KEY ("commentId")REFERENCES "public"."Comment"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Vote" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Vote" ADD FOREIGN KEY ("postId")REFERENCES "public"."Post"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_follows" ADD FOREIGN KEY ("A")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_follows" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_TopicToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Topic"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_TopicToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200609231041-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,132 @@
+generator client {
+  provider      = "prisma-client-js"
+  binaryTargets = ["native", "debian-openssl-1.0.x"]
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("POSTGRES_URL")
+}
+
+model User {
+  id             String        @default(cuid()) @id
+  createdAt      DateTime      @default(now())
+  updatedAt      DateTime      @updatedAt
+  email          String        
+  role           Role          @default(USER)
+  firstName      String?
+  lastName       String?
+  name           String?
+  name_lower     String?
+  username       String?       @unique
+  username_lower String?       @unique
+  headline       String?
+  avatar         String?
+  auth0id        String        @unique
+  identity       String?
+  privateKey     String
+  follows        User[]        @relation("follows", references: [id])
+  followedBy     User[]        @relation("follows", references: [id])
+  address        String
+  followedTopics Topic[]       @relation(references: [id])
+  comments       Comment[]
+  commentVotes   CommentVote[]
+  votes          Vote[]
+  posts          Post[]
+}
+
+model Topic {
+  id             String   @default(cuid()) @id
+  createdAt      DateTime @default(now())
+  updatedAt      DateTime @updatedAt
+  name           String
+  slug           String   @unique
+  description    String?
+  image          String?
+  followersCount Int?
+  postsCount     Int?
+  trending       Boolean?
+  posts          Post[]
+  followedBy     User[]   @relation(references: [id])
+}
+
+model Post {
+  id          String    @default(cuid()) @id
+  createdAt   DateTime  @default(now())
+  updatedAt   DateTime  @updatedAt
+  author      String?
+  date        String?
+  description String?
+  image       String?
+  logo        String?
+  publisher   String?
+  title       String?
+  url         String
+  archived    Boolean   @default(false)
+  pinned      Boolean   @default(false)
+  comments    Comment[]
+  votes       Vote[]
+  submitter   User      @relation(fields: [submitterId],references: [id])
+  submitterId String    
+}
+
+model Comment {
+  id        String        @default(cuid()) @id
+  createdAt DateTime      @default(now())
+  updatedAt DateTime      @updatedAt
+  text      String
+  post      Post?         @relation(references: [id], fields: [postId])
+  postId    String?
+  author    User          @relation(references: [id], fields:[authorId])
+  authorId  String
+  parent    Comment?      @relation("commentReplies", fields: [parentId], references: [id])
+  parentId  String?
+  replies   Comment[]     @relation("commentReplies")
+  votes     CommentVote[]
+}
+
+model CommentVote {
+  id        String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  user      User     @relation(references: [id], fields:[userId])
+  userId    String
+  comment   Comment  @relation(references: [id], fields:[commentId])
+  commentId String
+}
+
+model Vote {
+  id        String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  user      User     @relation(references: [id], fields: [userId])
+  userId    String
+  post      Post     @relation(references: [id], fields: [postId])
+  postId    String   
+}
+
+model Section {
+  id        String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  date      String   @unique
+  posts     Post[]
+}
+
+model SignedUpload {
+  id            String   @default(cuid()) @id
+  createdAt     DateTime @default(now())
+  updatedAt     DateTime @updatedAt
+  signedRequest String
+  url           String
+}
+
+enum Role {
+  ADMIN
+  USER
+}
+
+enum PostType {
+  PRODUCT
+  LINK
+}
```


