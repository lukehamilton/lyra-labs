# Migration `20191215172829-init`

This migration has been generated by Luke Hamilton at 12/15/2019, 5:28:29 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."User" (
  "address" text NOT NULL DEFAULT '' ,
  "auth0id" text NOT NULL DEFAULT '' ,
  "avatar" text   ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "email" text NOT NULL DEFAULT '' ,
  "firstName" text   ,
  "headline" text   ,
  "id" text NOT NULL  ,
  "identity" text   ,
  "lastName" text   ,
  "name" text NOT NULL DEFAULT '' ,
  "name_lower" text NOT NULL DEFAULT '' ,
  "privateKey" text NOT NULL DEFAULT '' ,
  "role" text NOT NULL DEFAULT 'USER' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "username" text NOT NULL DEFAULT '' ,
  "username_lower" text NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Topic" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "description" text   ,
  "followersCount" integer   ,
  "id" text NOT NULL  ,
  "image" text   ,
  "name" text NOT NULL DEFAULT '' ,
  "postsCount" integer   ,
  "slug" text NOT NULL DEFAULT '' ,
  "trending" boolean   ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Post" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "day" text NOT NULL DEFAULT '' ,
  "description" text   ,
  "featured" boolean   ,
  "id" text NOT NULL  ,
  "link" text   ,
  "name" text   ,
  "slug" text NOT NULL DEFAULT '' ,
  "tagline" text   ,
  "thumbnail" text   ,
  "type" text NOT NULL DEFAULT 'PRODUCT' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Comment" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "text" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."CommentVote" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Vote" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Section" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "date" text NOT NULL DEFAULT '' ,
  "id" text NOT NULL  ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."SignedUpload" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "signedRequest" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "url" text NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Post_galleryThumbs" (
  "nodeId" text NOT NULL  REFERENCES "public"."Post"("id") ON DELETE CASCADE,
  "position" integer NOT NULL  ,
  "value" text NOT NULL  ,
  PRIMARY KEY ("nodeId","position")
);

CREATE TABLE "public"."_CreatedPosts" (
  "A" text NOT NULL  REFERENCES "public"."Post"("id") ON DELETE CASCADE,
  "B" text NOT NULL  REFERENCES "public"."User"("id") ON DELETE CASCADE
);

CREATE TABLE "public"."_PostToTopic" (
  "A" text NOT NULL  REFERENCES "public"."Post"("id") ON DELETE CASCADE,
  "B" text NOT NULL  REFERENCES "public"."Topic"("id") ON DELETE CASCADE
);

ALTER TABLE "public"."User" ADD COLUMN "topic" text   REFERENCES "public"."Topic"("id") ON DELETE SET NULL;

ALTER TABLE "public"."Post" ADD COLUMN "section" text   REFERENCES "public"."Section"("id") ON DELETE SET NULL,
ADD COLUMN "submitter" text NOT NULL  REFERENCES "public"."User"("id") ON DELETE RESTRICT;

ALTER TABLE "public"."Comment" ADD COLUMN "author" text NOT NULL  REFERENCES "public"."User"("id") ON DELETE RESTRICT,
ADD COLUMN "comment" text   REFERENCES "public"."Comment"("id") ON DELETE SET NULL,
ADD COLUMN "parent" text   REFERENCES "public"."Comment"("id") ON DELETE SET NULL,
ADD COLUMN "post" text   REFERENCES "public"."Post"("id") ON DELETE SET NULL;

ALTER TABLE "public"."CommentVote" ADD COLUMN "comment" text NOT NULL  REFERENCES "public"."Comment"("id") ON DELETE RESTRICT,
ADD COLUMN "user" text NOT NULL  REFERENCES "public"."User"("id") ON DELETE RESTRICT;

ALTER TABLE "public"."Vote" ADD COLUMN "post" text NOT NULL  REFERENCES "public"."Post"("id") ON DELETE RESTRICT,
ADD COLUMN "user" text NOT NULL  REFERENCES "public"."User"("id") ON DELETE RESTRICT;

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "User.username" ON "public"."User"("username")

CREATE UNIQUE INDEX "User.username_lower" ON "public"."User"("username_lower")

CREATE UNIQUE INDEX "User.auth0id" ON "public"."User"("auth0id")

CREATE UNIQUE INDEX "Topic.slug" ON "public"."Topic"("slug")

CREATE UNIQUE INDEX "Post.slug" ON "public"."Post"("slug")

CREATE UNIQUE INDEX "Section.date" ON "public"."Section"("date")

CREATE UNIQUE INDEX "_CreatedPosts_AB_unique" ON "public"."_CreatedPosts"("A","B")

CREATE UNIQUE INDEX "_PostToTopic_AB_unique" ON "public"."_PostToTopic"("A","B")
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration ..20191215172829-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,121 @@
+generator photon {
+  provider = "photonjs"
+  binaryTargets = ["native", "debian-openssl-1.0.x"]
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = "postgresql://prisma:mypassword@lyra-labs-dev.cctuihe2uaxv.us-west-2.rds.amazonaws.com:5432/prisma?sslaccept=accept_invalid_certs"
+}
+
+model User {
+  id               String   @default(cuid()) @id
+  createdAt        DateTime @default(now())
+  updatedAt        DateTime @updatedAt
+  email            String   @unique
+  role             Role     @default(USER)
+  firstName        String?
+  lastName         String?
+  name             String
+  name_lower       String
+  username         String   @unique
+  username_lower   String   @unique
+  headline         String?
+  avatar           String?
+  auth0id          String   @unique
+  identity         String?
+  privateKey       String
+  address          String
+  submittedPosts   Post[]   @relation(name: "SubmittedPosts")
+  createdPosts     Post[]   @relation(name: "CreatedPosts")
+}
+
+model Topic {
+  id             String   @default(cuid()) @id
+  createdAt      DateTime @default(now())
+  updatedAt      DateTime @updatedAt
+  name           String
+  slug           String   @unique
+  description    String?
+  image          String?
+  followersCount Int?
+  postsCount     Int?
+  trending       Boolean?
+  posts          Post[]
+  followedBy     User[]
+}
+
+model Post {
+  id            String   @default(cuid()) @id
+  createdAt     DateTime @default(now())
+  updatedAt     DateTime @updatedAt
+  type          PostType @default(PRODUCT)
+  name          String?
+  slug          String   @unique
+  link          String?
+  thumbnail     String?
+  description   String?
+  tagline       String?
+  submitter     User     @relation(name: "SubmittedPosts")
+  creators      User[]   @relation(name: "CreatedPosts")
+  galleryThumbs String[]
+  comments      Comment[]
+  day           String
+  featured      Boolean?
+  topics        Topic[]
+  votes         Vote[]
+}
+
+model Comment {
+  id            String         @default(cuid()) @id
+  createdAt     DateTime       @default(now())
+  updatedAt     DateTime       @updatedAt
+  text          String    
+  post          Post?    
+  parent        Comment?       @relation(name: "CommentParent")
+  author        User    
+  replies       Comment[]      @relation(name: "CommentReplies")
+  votes         CommentVote[]
+}
+
+model CommentVote {
+  id            String   @default(cuid()) @id
+  createdAt     DateTime @default(now())
+  updatedAt     DateTime @updatedAt
+  user          User
+  comment       Comment
+}
+
+model Vote {
+  id            String   @default(cuid()) @id
+  createdAt     DateTime @default(now())
+  updatedAt     DateTime @updatedAt
+  user          User
+  post          Post
+}
+
+model Section {
+  id            String   @default(cuid()) @id
+  createdAt     DateTime @default(now())
+  updatedAt     DateTime @updatedAt
+  date          String   @unique
+  posts         Post[]
+}
+
+model SignedUpload {
+  id            String   @default(cuid()) @id
+  createdAt     DateTime @default(now())
+  updatedAt     DateTime @updatedAt
+  signedRequest String
+  url           String
+}
+
+enum Role {
+  ADMIN
+  USER
+}
+
+enum PostType {
+  PRODUCT
+  LINK
+}
```

## Photon Usage

You can use a specific Photon built for this migration (20191215172829-init)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20191215172829-init'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
